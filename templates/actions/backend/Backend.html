<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    {$_app_name = $wa->appName(true)}
    {$_account_name = $wa->accountName(true)}
    {$_title = $wa->title()|escape}
    <title>{$wa->title()|default:$_app_name} — {$_account_name}</title>

    {strip}{$priorities = []}
    {foreach $wa->tasks->config('priorities') as $priority}
        {$priorities[$priority.value] = $priority.name|escape}
    {/foreach}{/strip}

    {$loc = explode('_', $wa->locale())}
    
    <script src="{$wa_app_static_url}js/vendors/redactor-3-4-11/redactor.min.js"></script>
    <script src="{$wa_app_static_url}js/vendors/redactor-3-4-11/langs/{$loc[0]}.js"></script>
    <script src="{$wa_app_static_url}js/vendors/redactor-3-4-11/plugins/mdCodeButtons.js"></script>
    <script src="{$wa_app_static_url}js/vendors/redactor-3-4-11/plugins/handle/handle.js"></script>
    <script>
        $R.options = {
            lang: '{$loc[0]}',
            plugins: ['mdCodeButtons', 'handle'],
            handle: '?action=tagsatcmpl',
            handleTrigger: '#',
        };
    </script>
    
    <script src="{$wa_app_static_url}js/vendors/mdeditor/mdeditor.js"></script>

    <script src="{$wa_app_static_url}js/tasks.js?v{$wa->version()}"></script>
    <script>window.TasksController.initBeforeJQuery({
        accountName: {$wa->accountName(false)|json_encode},
        priorities: {$priorities|json_encode},
        app_icons: {$app_icons|json_encode},
        contact_id: {$wa->user('id')}
    });</script>

    {$wa->css()}
    <link href="{$wa_app_static_url}js/vendors/jquery-ui.min.css" rel="stylesheet" type="text/css" />
    <link href="{$wa_app_static_url}css/tasks.min.css?v{$wa->version()}" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="{$wa_url}wa-content/js/farbtastic/farbtastic.css" type="text/css" />
    <link rel="stylesheet" href="{$wa_app_static_url}js/waGallery/waGallery.css" type="text/css" />
    <link rel="stylesheet" href="{$wa_url}wa-content/js/prettify/prettify.css" type="text/css" />
    <link rel="stylesheet" href="{$wa_app_static_url}js/vendors/redactor-3-4-11/redactor.min.css" type="text/css" />
    <link rel="stylesheet" href="{$wa_app_static_url}js/vendors/redactor-3-4-11/plugins/handle/handle.css" type="text/css" />

    <script src="{$wa_url}wa-content/js/jquery/jquery-1.11.1.min.js"></script>
    <script src="{$wa_url}wa-content/js/jquery/jquery-migrate-1.2.1.min.js" async></script>
    <script src="{$wa_url}wa-content/js/prettify/prettify.js"></script>

    <script src="/wa-content/js/jquery-wa/wa.js?v={$wa->version(true)}"></script>
    <script src="{$wa_app_static_url}js/tasks.min.js?v{$wa->version()}"></script>

    <style>
        .re-button.re-quote {
            padding-bottom: 0 !important;
            padding-top: 15px !important;
        }
        /* .re-icon-quote {
            margin-top: 15px;
        } */
        .re-icon-quote::after {
            content: '”';
            font-size: 26px;
            line-height: 0;
            font-weight: bolder;
        }

        .redactor-styles blockquote {
            color: var(--text-color);
            padding: 1.5em 2em;
            background: var(--background-color-blockquote);
            margin: 0 0 1rem;
        }

        .redactor-styles blockquote p {
            margin-bottom: 0;
        }
    </style>

    {$wa->js()}
    {if $wa->locale() != 'en_US'}
        <script type="text/javascript" src="{$wa_url}wa-content/js/jquery-ui/i18n/jquery.ui.datepicker-{$wa->locale()}.js" async></script>
    {/if}

    {* @event backend_assets.%plugin_id% *}
    {foreach $backend_assets as $item}
        {$item}
    {/foreach}

</head>
<body>
    <div id="wa">
        {$wa->header()|replace:'></script>':' async></script>'}
        <div id="wa-app">
            <div class="flexbox wrap-mobile">
                {* SIDEBAR *}
                <aside class="t-sidebar-wrapper sidebar mobile-friendly width-15rem flexbox" id="sidebar">
                    <nav class="sidebar-mobile-toggle">
                        <div class="box align-center">
                            <a href="#" href="javascript:void(0);">
                                <i class="fas fa-bars"></i>
                                [`Menu`]
                            </a>
                        </div>
                    </nav>
                    {include file="./Sidebar.html" inline}
                </aside>

                {* MAIN CONTENT *}
                <main class="t-content-wrapper content blank">
                    <div id="content" data-loading-string="">
                        <div id="loaderPlace"></div>
                    </div>
                </main>
            </div>
        </div>
        {* DRAGOVER NOTICE *}
        <div class="f-file-dragover-wrapper">
            <div class="f-message-wrapper">[`Drop anywhere to upload`]</div>
        </div>
    </div>

    <div id="taskSkeleton" style="display: none;">
        {include file="../tasks/includes/TasksSkeleton.inc.html" inline}
    </div>

    <div id="tasksListSkeleton" style="display: none;">
        {include file="../tasks/includes/TasksListSkeleton.inc.html" inline}
    </div>

    {* if method_exists($wa->installer, 'reviewWidget')}
        {$wa->installer->reviewWidget('app/tasks')}
    {/if *}

    <script>
        (function() {
            var $loaderPlace = document.querySelector('#loaderPlace');
            if($loaderPlace){
                $loaderPlace.innerHTML = 
                    window.loadingEntity === 'task' 
                    ? document.querySelector('#taskSkeleton').innerHTML 
                    : window.loadingEntity === 'list' 
                    ? document.querySelector('#tasksListSkeleton').innerHTML 
                    : '<i class="icon16 loading"></i>';
            }
        })();
    </script>

    <script>$.wa.locale = $.extend($.wa.locale || {}, {
        'Search': "[`Search`]",
        'Either text or attachment is required to add comment.': "[`Either text or attachment is required to add comment.`]",
        'return': "[`Return`]",
        'forward': "[`Forward`]",
        'status': "[`Status`]",
    });</script>
    <script>window.TasksController.init();</script>

    <script>
        ( function($) {
            var $sidebar = $('#sidebar');
            $sidebar.waShowSidebar({
                direction: "down"
            });
        })(jQuery);
    </script>
</body>
</html>
